# Development Environment - External Infrastructure
# This values file disables all infrastructure services and requires external configurations
# All external services are accessed via provided endpoints
# Use with: helm install semantic-explorer . -f examples/values-external-infra-dev.yaml

global:
  environment: development
  # Init container image for startup ordering
  initContainer:
    image: "busybox:1.36"

# API Service - Development
api:
  enabled: true
  replicaCount: 1
  image:
    tag: "latest"
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  autoscaling:
    enabled: false
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  # Environment variables for external services
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    REDIS_URL: "redis://redis.example.com:6379"
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    S3_BUCKET: "semantic-explorer"
    S3_ENDPOINT: "https://s3.example.com"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Collections - Development
workerCollections:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    NATS_URL: "nats://nats.example.com:4222"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Datasets - Development
workerDatasets:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Visualizations - Development
workerVisualizationsPy:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  autoscaling:
    enabled: false
  env:
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    S3_BUCKET: "semantic-explorer"
    S3_ENDPOINT: "https://s3.example.com"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# All infrastructure services DISABLED - using external
postgresql:
  enabled: false
  external:
    enabled: true
    host: "postgres.example.com"
    port: 5432
    database: semantic_explorer
    username: user
    existingSecret: "external-postgresql-secret"
    passwordKey: "password"

redis:
  enabled: false
  external:
    enabled: true
    clusterNodes: "redis://redis.example.com:6379"

nats:
  enabled: false
  external:
    enabled: true
    url: "nats://nats.example.com:4222"

qdrant:
  enabled: false
  external:
    enabled: true
    url: "http://qdrant.example.com:6333"

minio:
  enabled: false
  external:
    enabled: true
    endpoint: "https://s3.example.com"
    region: "us-east-1"
    bucket: "semantic-explorer"
    existingSecret: "external-s3-secret"
    accessKeyIdKey: "access-key-id"
    secretAccessKeyKey: "secret-access-key"

# Storage Configuration (S3-compatible)
storage:
  s3:
    endpoint: "https://s3.example.com"
    region: "us-east-1"
    bucketName: "semantic-explorer"
    existingSecret: "external-s3-secret"
    accessKeyIdKey: "access-key-id"
    secretAccessKeyKey: "secret-access-key"

# Dex - OIDC Provider
dex:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Observability - Local OTEL for tracing/metrics aggregation
observability:
  otelCollector:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    config:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
              max_recv_msg_size_mib: 100
            http:
              endpoint: 0.0.0.0:4318
      exporters:
        # Example: export to managed observability service
        otlp:
          endpoint: "observability.example.com:4317"
        prometheus:
          endpoint: "0.0.0.0:8889"

  # Use external Prometheus instance
  prometheus:
    enabled: false
    external:
      enabled: true
      url: "http://prometheus.example.com:9090"

  # Quickwit - Optional, can point to external instance
  quickwit:
    enabled: false
    external:
      enabled: true
      url: "http://quickwit.example.com:7280"

# Prometheus subchart - Disabled when using external
prometheus:
  enabled: false

# Grafana subchart - Disabled when using external
grafana:
  enabled: false
  external:
    enabled: true
    url: "http://grafana.example.com:3000"

# Network Policy
networkPolicy:
  enabled: true
  ingress:
    fromIngress: true
  egress:
    toDns: true
    toInternet: true  # Required to reach external services

# ============================================================================
# REQUIRED EXTERNAL SERVICE CONFIGURATIONS
# ============================================================================
#
# Before deploying with this values file, create secrets for external services:
#
# kubectl create secret generic external-postgresql-secret \
#   --from-literal=password="your-postgres-password"
#
# kubectl create secret generic external-s3-secret \
#   --from-literal=access-key-id="your-access-key" \
#   --from-literal=secret-access-key="your-secret-key"
#
# Update the environment variables in the worker/api sections above with your
# actual external service endpoints.
# ============================================================================
