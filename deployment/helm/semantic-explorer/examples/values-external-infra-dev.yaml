# Development Environment - External Infrastructure
# This values file disables all infrastructure services and requires external configurations
# All external services are accessed via provided endpoints
# Use with: helm install semantic-explorer . -f examples/values-external-infra-dev.yaml

global:
  environment: development

# API Service - Development
api:
  enabled: true
  replicaCount: 1
  image:
    tag: "latest"
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  autoscaling:
    enabled: false
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  # Environment variables for external services
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    REDIS_URL: "redis://redis.example.com:6379"
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    S3_BUCKET: "semantic-explorer"
    S3_ENDPOINT: "https://s3.example.com"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Collections - Development
worker-collections:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    NATS_URL: "nats://nats.example.com:4222"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Datasets - Development
worker-datasets:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 15s
  env:
    DATABASE_URL: "postgres://user:password@postgres.example.com:5432/semantic_explorer"
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# Worker Visualizations - Development
worker-visualizations:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  autoscaling:
    enabled: false
  env:
    NATS_URL: "nats://nats.example.com:4222"
    QDRANT_URL: "http://qdrant.example.com:6333"
    S3_BUCKET: "semantic-explorer"
    S3_ENDPOINT: "https://s3.example.com"
    OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector:4317"

# All infrastructure services DISABLED
postgresql:
  enabled: false

redis:
  enabled: false

nats:
  enabled: false

qdrant:
  enabled: false

minio:
  enabled: false

# Dex - OIDC Provider
dex:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# OpenTelemetry Collector - Local for tracing/metrics aggregation
otel-collector:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    exporters:
      # Configure where to send metrics, traces, and logs
      # Example: export to managed observability service
      otlp:
        endpoint: "observability.example.com:4317"
      prometheus:
        endpoint: "0.0.0.0:8889"

# Grafana - Optional, can point to external instance
grafana:
  enabled: false  # Set to true if you want to run Grafana locally

# Quickwit - Optional, can point to external instance
quickwit:
  enabled: false  # Set to true if you want to run Quickwit locally

# Prometheus - Not needed, using external metrics backend
prometheus:
  enabled: false

# Network Policy
networkPolicy:
  enabled: true
  ingress:
    fromIngress: true
  egress:
    toDns: true
    toInternet: true  # Required to reach external services

# IMPORTANT: You must provide the following before deployment:
# 1. External PostgreSQL database connection details
# 2. External Redis endpoint(s)
# 3. External NATS server(s)
# 4. External Qdrant endpoint
# 5. External S3-compatible storage endpoint
# 6. S3 credentials (access key, secret key)
#
# Update the environment variables in the worker/api sections above with your actual values
# Or provide them via Kubernetes Secrets and reference them in the deployment templates
#
# Example:
#   apiVersion: v1
#   kind: Secret
#   metadata:
#     name: external-services
#   type: Opaque
#   stringData:
#     DATABASE_URL: "postgres://user:pass@db.example.com:5432/db"
#     S3_ACCESS_KEY: "your-access-key"
#     S3_SECRET_KEY: "your-secret-key"
