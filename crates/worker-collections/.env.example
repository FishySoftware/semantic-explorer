# ================================
# Service Configuration
# ================================
SERVICE_NAME=worker-collections

# ================================
# PostgreSQL Database Configuration
# ================================
DATABASE_URL=postgresql://semantic_explorer_user:semantic_explorer_password@localhost:5432/semantic_explorer

# ================================
# NATS Configuration
# ================================
NATS_URL=nats://localhost:4222

# ================================
# AWS S3 Configuration
# ================================
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_ENDPOINT_URL=http://minio:9000
S3_BUCKET_NAME=semantic-explorer-files
# S3 File Size Limits (in bytes)
S3_MAX_DOWNLOAD_SIZE_BYTES=104857600   # 100MB
S3_MAX_UPLOAD_SIZE_BYTES=1073741824    # 1GB

# ================================
# Worker Configuration
# ================================
MAX_CONCURRENT_JOBS=5

# Batch sizes
WORKER_QDRANT_UPLOAD_CHUNK_SIZE=200    # Chunk size for Qdrant vector uploads

# Retry configuration
WORKER_EMBEDDING_MAX_RETRIES=5         # Max retries for embedding operations

# NATS timeout configuration
NATS_CONNECTION_TIMEOUT_SECS=10        # NATS connection timeout
NATS_PING_INTERVAL_SECS=15             # NATS ping interval
NATS_STREAM_MAX_AGE_DAYS=7             # Max age for NATS stream messages
NATS_ACK_WAIT_SECS=600                 # Ack wait for collection jobs (10 min)

# ================================
# NATS Consumer Tuning
# ================================
NATS_MAX_ACK_PENDING=100                    # Max unacknowledged messages per consumer
NATS_COLLECTION_ACK_WAIT_SECS=600           # Ack wait for collection transforms (10 min)

# ================================
# Circuit Breaker Configuration
# ================================
S3_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
S3_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3
S3_CIRCUIT_BREAKER_TIMEOUT_SECS=30
S3_CIRCUIT_BREAKER_FAILURE_WINDOW_SECS=60

# ================================
# Retry Policy Configuration
# ================================
RETRY_MAX_ATTEMPTS=3
RETRY_INITIAL_DELAY_MS=100
RETRY_MAX_DELAY_MS=10000
RETRY_BACKOFF_MULTIPLIER=2.0
S3_RETRY_MAX_ATTEMPTS=3

# ================================
# Observability & Monitoring
# ================================
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
LOG_FORMAT=json
RUST_LOG=worker_collections=debug
